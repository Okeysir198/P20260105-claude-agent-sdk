agent_id: debt_collection
sub_agent_id: script_types
description: "Tests for all script type variations and their specific behaviors"

test_cases:
  # ===========================
  # RATIO1_SHORT_PAID TESTS
  # ===========================
  - name: "SCR-001: Short paid - acknowledgment of partial payment"
    test_type: single_turn
    tags: [unit, ratio1_short_paid, acknowledgment]
    context:
      script_type: "ratio1_short_paid"
      account_status: "active"
      outstanding_amount: 5000.00
      overdue_days: 60
      partial_payment_received: 3000.00
      agreed_amount: 5000.00
    turns:
      - user_input: "I already paid R3,000 last month"
        assertions:
          - type: llm-rubric
            value: "Agent acknowledges the partial payment of R3,000 and thanks the customer"

  - name: "SCR-002: Short paid - shortfall calculation"
    test_type: single_turn
    tags: [unit, ratio1_short_paid, calculation]
    context:
      script_type: "ratio1_short_paid"
      account_status: "active"
      outstanding_amount: 2000.00
      partial_payment_received: 3000.00
      agreed_amount: 5000.00
    turns:
      - user_input: "How much do I still owe?"
        assertions:
          - type: llm-rubric
            value: "Agent mentions the shortfall amount of R2,000 (agreed R5,000 minus paid R3,000)"

  - name: "SCR-003: Short paid - 30% discount offer"
    test_type: single_turn
    tags: [unit, ratio1_short_paid, discount]
    context:
      script_type: "ratio1_short_paid"
      account_status: "active"
      outstanding_amount: 2000.00
      overdue_days: 45
      partial_payment_received: 3000.00
      agreed_amount: 5000.00
    turns:
      - user_input: "Can you offer me a settlement?"
        assertions:
          - type: llm-rubric
            value: "Agent offers 30% discount settlement (ratio1_short_paid has 30% discount)"

  # ===========================
  # RATIO1_PRO_RATA TESTS
  # ===========================
  - name: "SCR-004: Pro rata - new customer service activation"
    test_type: single_turn
    tags: [unit, ratio1_pro_rata, activation]
    context:
      script_type: "ratio1_pro_rata"
      account_status: "cancelled"
      outstanding_amount: 1200.00
      overdue_days: 30
      monthly_subscription: 299.00
    turns:
      - user_input: "Will my service be activated after I pay?"
        assertions:
          - type: llm-rubric
            value: "Agent explains service activation process for new customer (not reactivation)"

  - name: "SCR-005: Pro rata - no discount available"
    test_type: single_turn
    tags: [unit, ratio1_pro_rata, no_discount]
    context:
      script_type: "ratio1_pro_rata"
      account_status: "active"
      outstanding_amount: 1500.00
      overdue_days: 20
    turns:
      - user_input: "Can I get a discount?"
        assertions:
          - type: llm-rubric
            value: "Agent explains that pro-rata arrangements do not include discounts (discount_enabled: false)"

  # ===========================
  # RATIO1_FAILED_PTP TESTS
  # ===========================
  - name: "SCR-006: Failed PTP - bank validation warning"
    test_type: single_turn
    tags: [unit, ratio1_failed_ptp, bank_validation]
    context:
      script_type: "ratio1_failed_ptp"
      account_status: "active"
      outstanding_amount: 4500.00
      overdue_days: 75
      has_reversal_history: true
      bank_name: "FNB"
    turns:
      - user_input: "Yes, I can set up a debit order on my FNB account"
        assertions:
          - type: llm-rubric
            value: "Agent warns about previous payment reversals and validates bank details carefully"

  - name: "SCR-007: Failed PTP - same bank as previous failure"
    test_type: single_turn
    tags: [unit, ratio1_failed_ptp, same_bank]
    context:
      script_type: "ratio1_failed_ptp"
      account_status: "active"
      outstanding_amount: 3200.00
      has_reversal_history: true
      bank_name: "Standard Bank"
    turns:
      - user_input: "Use the same Standard Bank account as before"
        assertions:
          - type: contains_function_call
            value: "validate_bank_details"
          - type: llm-rubric
            value: "Agent flags that this is the same bank account that previously failed"

  # ===========================
  # RATIO2_3_INFLOW TESTS
  # ===========================
  - name: "SCR-008: Ratio 2-3 - R25,000 recovery fee warning"
    test_type: single_turn
    tags: [unit, ratio2_3_inflow, recovery_fee]
    context:
      script_type: "ratio2_3_inflow"
      account_status: "overdue"
      outstanding_amount: 8500.00
      overdue_days: 95
      vehicle_registration: "ABC123GP"
    turns:
      - user_input: "What happens if I don't pay?"
        assertions:
          - type: llm-rubric
            value: "Agent warns about R25,000 vehicle recovery fee and possible legal action"

  - name: "SCR-009: Ratio 2-3 - max 4 payment installments"
    test_type: single_turn
    tags: [unit, ratio2_3_inflow, installments]
    context:
      script_type: "ratio2_3_inflow"
      account_status: "overdue"
      outstanding_amount: 6000.00
      overdue_days: 80
    turns:
      - user_input: "Can I pay over 6 months?"
        assertions:
          - type: llm-rubric
            value: "Agent explains maximum is 4 months for ratio2_3 accounts (not 6 months)"

  - name: "SCR-010: Ratio 2-3 - 30% settlement discount"
    test_type: single_turn
    tags: [unit, ratio2_3_inflow, discount]
    context:
      script_type: "ratio2_3_inflow"
      account_status: "overdue"
      outstanding_amount: 5000.00
      overdue_days: 90
    turns:
      - user_input: "What settlement can you offer?"
        assertions:
          - type: llm-rubric
            value: "Agent offers 30% settlement discount (ratio2_3 has 30% discount)"

  # ===========================
  # RECENTLY_SUSPENDED_120 TESTS
  # ===========================
  - name: "SCR-011: Recently suspended - Tier 1 50% settlement offer"
    test_type: single_turn
    tags: [unit, recently_suspended_120, tier1]
    context:
      script_type: "recently_suspended_120"
      account_status: "suspended"
      outstanding_amount: 10000.00
      overdue_days: 110
    turns:
      - user_input: "What's your best offer?"
        assertions:
          - type: llm-rubric
            value: "Agent offers Tier 1: 50% discount settlement valid until 25th of the month"

  - name: "SCR-012: Recently suspended - Tier 2 fallback 40% with installments"
    test_type: single_turn
    tags: [unit, recently_suspended_120, tier2]
    context:
      script_type: "recently_suspended_120"
      account_status: "suspended"
      outstanding_amount: 8000.00
      overdue_days: 105
    turns:
      - user_input: "I can't pay the full settlement, can I get installments?"
        assertions:
          - type: llm-rubric
            value: "Agent offers Tier 2: 40% discount with 2 installment payments, valid until 28th of the month"

  - name: "SCR-013: Recently suspended - deadline calculation Tier 1"
    test_type: single_turn
    tags: [unit, recently_suspended_120, deadline]
    context:
      script_type: "recently_suspended_120"
      account_status: "suspended"
      outstanding_amount: 12000.00
      overdue_days: 118
    turns:
      - user_input: "When do I need to pay by?"
        assertions:
          - type: llm-rubric
            value: "Agent mentions deadline of 25th of current/next month for 50% discount"

  - name: "SCR-014: Recently suspended - max 3 payment months"
    test_type: single_turn
    tags: [unit, recently_suspended_120, max_payments]
    context:
      script_type: "recently_suspended_120"
      account_status: "suspended"
      outstanding_amount: 9000.00
      overdue_days: 115
    turns:
      - user_input: "Can I pay over 6 months?"
        assertions:
          - type: llm-rubric
            value: "Agent explains maximum is 3 months for recently_suspended_120 accounts"

  # ===========================
  # PRELEGAL_120 TESTS
  # ===========================
  - name: "SCR-015: Prelegal 120 - letter of demand messaging"
    test_type: single_turn
    tags: [unit, prelegal_120, letter_of_demand]
    context:
      script_type: "prelegal_120"
      account_status: "collections"
      outstanding_amount: 7500.00
      overdue_days: 125
    turns:
      - user_input: "Why are you calling me?"
        assertions:
          - type: llm-rubric
            value: "Agent mentions letter of demand and pre-legal status"

  - name: "SCR-016: Prelegal 120 - Cartrack authority handoff"
    test_type: single_turn
    tags: [unit, prelegal_120, authority]
    context:
      script_type: "prelegal_120"
      account_status: "collections"
      outstanding_amount: 6000.00
      overdue_days: 130
    turns:
      - user_input: "Who authorized you to call me?"
        assertions:
          - type: llm-rubric
            value: "Agent identifies calling on behalf of Cartrack and references Viljoen Attorneys"

  - name: "SCR-017: Prelegal 120 - max 3 months installments"
    test_type: single_turn
    tags: [unit, prelegal_120, installments]
    context:
      script_type: "prelegal_120"
      account_status: "collections"
      outstanding_amount: 5500.00
      overdue_days: 122
    turns:
      - user_input: "I need to pay over 6 months"
        assertions:
          - type: llm-rubric
            value: "Agent explains maximum is 3 months for prelegal_120 stage"

  # ===========================
  # PRELEGAL_150 TESTS
  # ===========================
  - name: "SCR-018: Prelegal 150 - Viljoen Attorneys identity"
    test_type: single_turn
    tags: [unit, prelegal_150, viljoen]
    context:
      script_type: "prelegal_150"
      account_status: "collections"
      outstanding_amount: 8200.00
      overdue_days: 155
    turns:
      - user_input: "Who is calling?"
        assertions:
          - type: llm-rubric
            value: "Agent identifies as calling from Viljoen Attorneys (010-140-0085)"

  - name: "SCR-019: Prelegal 150 - summons and sheriff warning"
    test_type: single_turn
    tags: [unit, prelegal_150, summons]
    context:
      script_type: "prelegal_150"
      account_status: "collections"
      outstanding_amount: 9500.00
      overdue_days: 162
    turns:
      - user_input: "What will happen if I don't pay?"
        assertions:
          - type: llm-rubric
            value: "Agent warns about summons being served by sheriff and potential court action"

  - name: "SCR-020: Prelegal 150 - attorney stage consequences"
    test_type: single_turn
    tags: [unit, prelegal_150, consequences]
    context:
      script_type: "prelegal_150"
      account_status: "collections"
      outstanding_amount: 7800.00
      overdue_days: 158
    turns:
      - user_input: "This is serious?"
        assertions:
          - type: llm-rubric
            value: "Agent explains attorney stage severity and escalation to legal proceedings"

  # ===========================
  # LEGAL_STAGE TESTS
  # ===========================
  - name: "SCR-021: Legal stage - 70% discount tier 1 (balance <= R1,500)"
    test_type: single_turn
    tags: [unit, legal_stage, tier1_discount]
    context:
      script_type: "legal_stage"
      account_status: "legal"
      outstanding_amount: 1200.00
      overdue_days: 180
    turns:
      - user_input: "Can you offer a settlement?"
        assertions:
          - type: llm-rubric
            value: "Agent offers 70% discount settlement for tier 1 balance (≤R1,500)"

  - name: "SCR-022: Legal stage - 75% discount tier 2 (R1,500 < balance <= R5,000)"
    test_type: single_turn
    tags: [unit, legal_stage, tier2_discount]
    context:
      script_type: "legal_stage"
      account_status: "legal"
      outstanding_amount: 3500.00
      overdue_days: 195
    turns:
      - user_input: "What settlement can you give me?"
        assertions:
          - type: llm-rubric
            value: "Agent offers 75% discount settlement for tier 2 balance (R1,500-R5,000)"

  - name: "SCR-023: Legal stage - 75% discount tier 3 (balance > R5,000)"
    test_type: single_turn
    tags: [unit, legal_stage, tier3_discount]
    context:
      script_type: "legal_stage"
      account_status: "legal"
      outstanding_amount: 8000.00
      overdue_days: 210
    turns:
      - user_input: "Is there a settlement option?"
        assertions:
          - type: llm-rubric
            value: "Agent offers 75% discount settlement for tier 3 balance (>R5,000)"

  - name: "SCR-024: Legal stage - garnishee order warning"
    test_type: single_turn
    tags: [unit, legal_stage, garnishee]
    context:
      script_type: "legal_stage"
      account_status: "legal"
      outstanding_amount: 6500.00
      overdue_days: 200
    turns:
      - user_input: "What legal action are you taking?"
        assertions:
          - type: llm-rubric
            value: "Agent warns about garnishee orders (salary deductions) and judgment"

  - name: "SCR-025: Legal stage - court proceedings messaging"
    test_type: single_turn
    tags: [unit, legal_stage, court]
    context:
      script_type: "legal_stage"
      account_status: "legal"
      outstanding_amount: 5200.00
      overdue_days: 188
    turns:
      - user_input: "Is this going to court?"
        assertions:
          - type: llm-rubric
            value: "Agent confirms court proceedings have been initiated or are imminent"

  # ===========================
  # BOOKSALE_STAGE TESTS
  # ===========================
  - name: "SCR-026: Booksale - 75% discount tier 1 (balance <= R1,500)"
    test_type: single_turn
    tags: [unit, booksale_stage, tier1_discount]
    context:
      script_type: "booksale_stage"
      account_status: "booksale"
      outstanding_amount: 1400.00
      overdue_days: 240
    turns:
      - user_input: "What's your final offer?"
        assertions:
          - type: llm-rubric
            value: "Agent offers 75% discount settlement for tier 1 balance (≤R1,500)"

  - name: "SCR-027: Booksale - 80% discount tier 2 (R1,500 < balance <= R5,000)"
    test_type: single_turn
    tags: [unit, booksale_stage, tier2_discount]
    context:
      script_type: "booksale_stage"
      account_status: "booksale"
      outstanding_amount: 3200.00
      overdue_days: 255
    turns:
      - user_input: "Can I settle this?"
        assertions:
          - type: llm-rubric
            value: "Agent offers 80% discount settlement for tier 2 balance (R1,500-R5,000)"

  - name: "SCR-028: Booksale - 80% discount tier 3 (balance > R5,000)"
    test_type: single_turn
    tags: [unit, booksale_stage, tier3_discount]
    context:
      script_type: "booksale_stage"
      account_status: "booksale"
      outstanding_amount: 9500.00
      overdue_days: 270
    turns:
      - user_input: "What discount can you give?"
        assertions:
          - type: llm-rubric
            value: "Agent offers 80% discount settlement for tier 3 balance (>R5,000)"

  - name: "SCR-029: Booksale - final stage messaging"
    test_type: single_turn
    tags: [unit, booksale_stage, final_stage]
    context:
      script_type: "booksale_stage"
      account_status: "booksale"
      outstanding_amount: 5800.00
      overdue_days: 265
    turns:
      - user_input: "Why should I pay now?"
        assertions:
          - type: llm-rubric
            value: "Agent emphasizes this is the final stage before write-off and credit bureau reporting"

  - name: "SCR-030: Booksale - write-off warning"
    test_type: single_turn
    tags: [unit, booksale_stage, writeoff]
    context:
      script_type: "booksale_stage"
      account_status: "booksale"
      outstanding_amount: 4200.00
      overdue_days: 280
    turns:
      - user_input: "What happens if I don't pay?"
        assertions:
          - type: llm-rubric
            value: "Agent warns about account write-off and permanent credit record impact"

  # ===========================
  # ACCOUNT STATUS VARIATIONS
  # ===========================
  - name: "SCR-031: Active account - service reinstatement messaging"
    test_type: single_turn
    tags: [unit, account_status, active]
    context:
      script_type: "ratio1_inflow"
      account_status: "active"
      outstanding_amount: 3500.00
      overdue_days: 50
    turns:
      - user_input: "Will my Cartrack still work after I pay?"
        assertions:
          - type: llm-rubric
            value: "Agent confirms service will be reinstated or will continue working once account is settled"

  - name: "SCR-032: Cancelled account - paid-up letter messaging"
    test_type: single_turn
    tags: [unit, account_status, cancelled]
    context:
      script_type: "ratio1_inflow"
      account_status: "cancelled"
      outstanding_amount: 2800.00
      overdue_days: 35
    turns:
      - user_input: "What do I get after paying?"
        assertions:
          - type: llm-rubric
            value: "Agent explains paid-up letter will be provided (not service reactivation for cancelled accounts)"

  - name: "SCR-033: Suspended account - reactivation process"
    test_type: single_turn
    tags: [unit, account_status, suspended]
    context:
      script_type: "recently_suspended_120"
      account_status: "suspended"
      outstanding_amount: 6500.00
      overdue_days: 112
    turns:
      - user_input: "How do I get my service back?"
        assertions:
          - type: llm-rubric
            value: "Agent explains reactivation process after payment is received and cleared"

  # ===========================
  # CROSS-SCRIPT COMPARISONS
  # ===========================
  - name: "SCR-034: Ratio1 vs Ratio2 - max payments difference"
    test_type: single_turn
    tags: [integration, comparison, max_payments]
    context:
      script_type: "ratio1_inflow"
      account_status: "active"
      outstanding_amount: 7000.00
      overdue_days: 65
    turns:
      - user_input: "Can I pay over 6 months?"
        assertions:
          - type: llm-rubric
            value: "Agent confirms 6 months is acceptable for ratio1 (max_payments: 6)"

  - name: "SCR-035: Ratio1 vs Ratio2 - installment months"
    test_type: single_turn
    tags: [integration, comparison, installments]
    context:
      script_type: "ratio2_3_inflow"
      account_status: "overdue"
      outstanding_amount: 7000.00
      overdue_days: 85
    turns:
      - user_input: "Can I pay over 6 months?"
        assertions:
          - type: llm-rubric
            value: "Agent explains maximum is 4 months for ratio2_3 (not 6 like ratio1)"

  - name: "SCR-036: Standard vs Attorney authority"
    test_type: single_turn
    tags: [integration, comparison, authority]
    context:
      script_type: "prelegal_150"
      account_status: "collections"
      outstanding_amount: 8500.00
      overdue_days: 160
    turns:
      - user_input: "Who do you work for?"
        assertions:
          - type: llm-rubric
            value: "Agent identifies Viljoen Attorneys (not Cartrack directly)"

  - name: "SCR-037: Discount tiers - prelegal vs legal vs booksale"
    test_type: multi_turn
    tags: [integration, comparison, discount_tiers]
    turns:
      - user_input: "What discount can I get on my R3,000 debt at legal stage?"
        context:
          script_type: "legal_stage"
          outstanding_amount: 3000.00
          overdue_days: 185
        assertions:
          - type: llm-rubric
            value: "Agent offers 75% discount for legal stage tier 2"
      - user_input: "What if it's at booksale stage?"
        context:
          script_type: "booksale_stage"
          outstanding_amount: 3000.00
          overdue_days: 250
        assertions:
          - type: llm-rubric
            value: "Agent offers 80% discount for booksale stage tier 2 (higher than legal)"
