services:
  # Trung-bot - API Server Mode
  trung-bot:
    build:
      context: .
      dockerfile: Dockerfile
    image: trung-bot:latest
    container_name: trung-bot-api

    # Host networking â€” container shares host's network stack
    # No ports mapping needed; API available at localhost:7003
    network_mode: host

    # Environment variables from production .env file
    env_file:
      - .env.docker

    environment:
      - PYTHONUNBUFFERED=1

    # Volumes for persistence
    volumes:
      # Session data persistence
      - ./data:/app/data

      # Config file (allows provider switching without rebuild)
      - ./config.yaml:/app/config.yaml

    # Resource limits (per official Anthropic requirements: 1GiB RAM, 1 CPU)
    deploy:
      resources:
        limits:
          cpus: '1'
          memory: 1G
        reservations:
          cpus: '0.5'
          memory: 512M

    # Restart policy
    restart: unless-stopped

    # Command override for API server mode
    command: ["python", "main.py", "serve", "--port", "7003"]


